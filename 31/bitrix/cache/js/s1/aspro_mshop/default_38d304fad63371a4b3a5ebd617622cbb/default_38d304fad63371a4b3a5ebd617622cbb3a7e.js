
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/templates/aspro_mshop/components/bitrix/forum.topic.reviews/main/script.min.js?151740334115849";s:6:"source";s:82:"/bitrix/templates/aspro_mshop/components/bitrix/forum.topic.reviews/main/script.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
!function(e){e.FTRList=function(e){if(this.id="FTRList"+e.form.id,this.mess={},this.form=e.form,e.id)for(var t=0;t<e.id.length;t++)this.bind(e.id[t]);this.params={preorder:"Y"==e.preorder,pageNumber:e.pageNumber,pageCount:e.pageCount},BX.addCustomEvent(this.form,"onAdd",BX.delegate(this.add,this)),BX.addCustomEvent(this.form,"onRequest",BX.delegate(function(){if(void 0!==this.params.pageNumber){var e=BX.findChild(this.form,{attr:{name:"pageNumber"}});e||(e=BX.create("input",{props:{type:"hidden",name:"pageNumber"}}),this.form.appendChild(e)),e.value=this.params.pageNumber}if(void 0!==this.params.pageCount){var t=BX.findChild(this.form,{attr:{name:"pageCount"}});t||(t=BX.create("input",{props:{type:"hidden",name:"pageCount"}}),this.form.appendChild(t)),t.value=this.params.pageCount}},this)),BX.addCustomEvent(this.form,"onResponse",BX.delegate(function(){var e=BX.findChild(this.form,{attr:{name:"pageNumber"}},!0);e&&BX.remove(e)},this))},e.FTRList.prototype={add:function(t,i){var s,r=BX(this.form.id+"container"),o={className:/reviews-reply-form|reviews-collapse/},a=e.fTextToNode(i.message);if(r||(r=BX.create("div",{attrs:{id:this.form.id+"container"},props:{className:"reviews-block-container reviews-reviews-block-container"},children:[BX.create("div",{props:{className:"reviews-block-outer"},children:[BX.create("div",{props:{className:"reviews-block-inner"}})]})]}),e.fReplaceOrInsertNode(r,null,BX.findChild(document,o,!0).parentNode,o),r=BX(this.form.id+"container")),s=r?BX.findChild(r,{className:"reviews-block-inner"},!0):null,a&&s){if(i.allMessages){if(e.fReplaceOrInsertNode(a,s,BX.findChild(document,o,!0).parentNode,o),i.navigation&&i.pageNumber){var n,d=e.fTextToNode(i.navigation),l=d?BX.findChildren(r.parentNode,{className:"reviews-navigation-box"},!0):null;if(d){if(!l){r.parentNode.insertBefore(BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-top"}}),r);var h=r;do{h=h.nextSibling}while(h&&1!=h.nodeType);var m=BX.create("div",{props:{className:"reviews-navigation-box reviews-navigation-bottom"}});h?r.parentNode.insertBefore(m,h):r.parentNode.appendChild(m),l=BX.findChildren(r.parentNode,{className:"reviews-navigation-box"},!0)}for(n=0;n<l.length;n++)l[n].innerHTML=d.innerHTML}this.params.pageNumber=i.pageNumber,this.params.pageCount=i.pageCount}if(i.messagesID&&"object"==typeof i.messagesID)for(var c=0;c<i.messagesID.length;c++)i.messagesID[c]!=t&&this.bind(i.messagesID[c])}else void 0!==i.message&&(this.params.preorder?s.appendChild(a):s.insertBefore(a,s.firstChild));e.fRunScripts(i.message),this.bind(t)}},bind:function(e){var t=BX("message"+e);if(t){this.mess["m"+e]={node:t,author:{id:t.getAttribute("bx-author-id"),name:t.getAttribute("bx-author-name")}};var i=BX.findChildren(t,{tagName:"A",className:"reviews-button-small"},!0),s=BX.delegate(function(){var t=BX.proxy_context;this.act(t.getAttribute("bx-act"),e)},this),r=BX.delegate(function(){this.act("reply",e)},this),o=BX.delegate(function(){this.act("quote",e)},this);if(i&&i.length>0)for(var a=0;a<i.length;a++)"moderate"==i[a].getAttribute("bx-act")||"del"==i[a].getAttribute("bx-act")?BX.adjust(i[a],{events:{click:s},attrs:{"bx-href":i[a].getAttribute("href"),href:"javascript:void(0);"}}):this.form&&("reply"==i[a].getAttribute("bx-act")?BX.bind(i[a],"click",r):"quote"==i[a].getAttribute("bx-act")&&BX.bind(i[a],"mousedown",o))}},act:function(t,i){if(i&&this.mess["m"+i])if("quote"==t){var s=e.GetSelection();if(document.getSelection&&(s=(s=s.replace(/\r\n\r\n/gi,"_newstringhere_").replace(/\r\n/gi," ")).replace(/  /gi,"").replace(/_newstringhere_/gi,"\r\n\r\n")),""===s&&i>0&&BX("message_text_"+i,!0)){var r=BX("message_text_"+i,!0);"object"==typeof r&&r&&(s=r.innerHTML)}s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s.replace(/[\n|\r]*<br(\s)*(\/)*>/gi,"\n")).replace(/<script[^>]*>/gi,"").replace(/<\/script[^>]*>/gi,"")).replace(/\001([^\002]*)\002/gi,function(e,t){var i=" ",s=/showWMVPlayer.*?bx_wmv_player.*?file:[\s'"]*([^"']*).*?width:[\s'"]*([^"']*).*?height:[\s'"]*([^'"]*).*?/gi.exec(t);return s&&(i="[VIDEO WIDTH="+s[2]+" HEIGHT="+s[3]+"]"+s[1]+"[/VIDEO]")," "==i&&(s=/bxPlayerOnload[\s\S]*?[\s'"]*file[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*height[\s'"]*:[\s'"]*([^"']*)[\s\S]*?[\s'"]*width[\s'"]*:[\s'"]*([^"']*)/gi.exec(t))&&(i="[VIDEO WIDTH="+s[3]+" HEIGHT="+s[2]+"]"+s[1]+"[/VIDEO]"),i})).replace(/<noscript[^>]*>/gi,"").replace(/<\/noscript[^>]*>/gi,"")).replace(/\003([^\004]*)\004/gi," ")).replace(/<table class\=[\"]*forum-quote[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"")).replace(/<table class\=[\"]*forum-code[\"]*>[^<]*<thead>[^<]*<tr>[^<]*<th>([^<]+)<\/th><\/tr><\/thead>[^<]*<tbody>[^<]*<tr>[^<]*<td>/gi,"")).replace(/<table class\=[\"]*data-table[\"]*>[^<]*<tbody>/gi,"")).replace(/<\/td>[^<]*<\/tr>(<\/tbody>)*<\/table>/gi,"")).replace(/[\r|\n]{2,}([\001|\002])/gi,"\n$1");for(var o=0;o++<50&&(s.search(/\002([^\002\003]*)\003/gi)>=0||s.search(/\001([^\001\003]*)\003/gi)>=0);)s=s.replace(/\002([^\002\003]*)\003/gi,"[CODE]$1[/CODE]").replace(/\001([^\001\003]*)\003/gi,"[QUOTE]$1[/QUOTE]");var a=function(e,t,i){for(var s=new RegExp("([^]*)("+t+")([^]*)","i"),r=new RegExp("((?:)(?:[^]*))("+t+")((?:[^]*)(?:))","i"),o=0;o++<300&&e.search(s)>=0;)e=e.replace(r,"$1"+i+"$3");return e};for(o=0;o++<10&&s.search(/\004([^\004\003]*)\003/gi)>=0;)s=(s=a(s=a(s=a(s=a(s,"<tr>","[TR]"),"</tr>","[/TR]"),"<td>","[TD]"),"</td>","[/TD]")).replace(/\004([^\004\003]*)\003/gi,"[TABLE]$1[/TD][/TR][/TABLE]");s=(s=(s=(s=(s=(s=(s=BX.browser.IsIE()?s.replace(/<img(?:(?:\s+alt\s*=\s*\"?smile([^\"\s]+)\"?)|(?:\s+\w+\s*=\s*[^\s>]*))*>/gi,"$1"):s.replace(/<img.*?alt=[\"]*smile([^\"\s]+)[\"]*[^>]*>/gi,"$1")).replace(/<a[^>]+href=[\"]([^\"]+)\"[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]")).replace(/<a[^>]+href=[\']([^\']+)\'[^>]+>([^<]+)<\/a>/gi,"[URL=$1]$2[/URL]")).replace(/<[^>]+>/gi," ").replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')).replace(/(smile(?=[:;8]))/g,"")).replace(/\&shy;/gi,"")).replace(/\&nbsp;/gi," "),BX.onCustomEvent(this.form,"onQuote",[{author:this.mess["m"+i].author,id:i,text:s}])}else if("reply"==t)BX.onCustomEvent(this.form,"onReply",[{author:this.mess["m"+i].author,id:i}]);else if("del"!=t||confirm(BX.message("f_cdm"))){if("moderate"==t||"del"==t){var n=BX.proxy_context,d=n.getAttribute("bx-href").replace(/.AJAX_CALL=Y/g,"").replace(/.sessid=[^&]*/g,""),l=BX.findParent(n,{tag:"table"}),h=BX.create("a",{attrs:{className:"reply-action-note"}}),m=function(){BX.remove(h),BX.show(n.parentNode)};BX.hide(n.parentNode),h.innerHTML=BX.message("f_wait"),n.parentNode.parentNode.appendChild(h),BX.ajax.loadJSON(d,{AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},BX.delegate(function(i){if(i.status&&l)if(BX.onCustomEvent(e,"onForumCommentAJAXAction",[t]),"del"==t){var s=e.curpage||top.window.location.href;BX.fx.hide(l,"scroll",{time:.15,callback_complete:BX.delegate(function(){BX.remove(l),m();var e=BX.findChild(BX(this.form.id+"container"),{class:"reviews-post-table"},!0,!0);(!e||e.length<1)&&this.params.pageNumber>1&&BX.reload(s)},this)})}else{var r=BX.hasClass(l,"reviews-post-hidden"),o=r?BX.message("f_hide"):BX.message("f_show"),a=BX.findChild(l,{className:"reviews-text"},!0);BX.fx.hide(a,"fade",{time:.1,callback_complete:function(){BX.toggleClass(l,"reviews-post-hidden"),n.innerHTML=o,d=d.replace(new RegExp("REVIEW_ACTION="+(r?"SHOW":"HIDE")),"REVIEW_ACTION="+(r?"HIDE":"SHOW")),n.setAttribute("bx-href",d),BX.fx.show(a,"fade",{time:.1}),m(),BX.style(a,"background-color",r?"#FFFFFF":"#E5F8E3")}})}else BX.addClass(h,"error"),h.innerHTML='<span class="errortext">'+i.message+"</span>"},this))}}else BX.DoNothing();else BX.DoNothing();return!1}},e.FTRForm=function(t){this.id="FTRForm"+t.form.id,this.form=t.form,this.editorName=t.editorName,this.editorId=t.editorId,this.editor=e[t.editorName],this.windowEvents={},this.editor?this.addParsers(this.editor):(this.windowEvents.LHE_OnInit=BX.delegate(function(e){e.id==this.editorId&&(this.addParsers(e),this.editor=e)},this),this.windowEvents.LHE_ConstructorInited=BX.delegate(function(e){e.id==this.editorId&&(this.editor||(this.addParsers(e),this.editor=e),this.editor.ucInited=!0)},this),BX.addCustomEvent(e,"LHE_OnInit",this.windowEvents.LHE_OnInit),BX.addCustomEvent(e,"LHE_ConstructorInited",this.windowEvents.LHE_ConstructorInited)),this.params={messageMax:64e3},BX.addCustomEvent(this.form,"onQuote",BX.delegate(function(e){this.show(),this.paste(e,"QUOTE")},this)),BX.addCustomEvent(this.form,"onReply",BX.delegate(function(e){this.show(),this.paste(e,"REPLY")},this))},e.FTRForm.prototype={addParsers:function(e){e.AddParser({name:"postuser",obj:{Parse:function(e,t,i){return t=t.replace(/\[USER\s*=\s*(\d+)\]((?:\s|\S)*?)\[\/USER\]/gi,function(e,t,s){return t=parseInt(t),s=BX.util.trim(s),'<span id="'+i.SetBxTag(!1,{tag:"postuser",params:{value:t}})+'" style="color: #2067B0; border-bottom: 1px dashed #2067B0;">'+s+"</span>"})},UnParse:function(e,t,i){if("postuser"==e.tag){for(var s="",r=0;r<t.arNodes.length;r++)s+=i._RecursiveGetHTML(t.arNodes[r]);return s=BX.util.trim(s),"[USER="+e.params.value+"]"+s+"[/USER]"}return""}}})},validate:function(t){var i=this.form,s="",r=i.REVIEW_TEXT.value.length;if(i.BXFormSubmit_save)return!0;if(i.TITLE&&i.TITLE.value.length<2&&(s+=BX.message("no_topic_name")),r<2?s+=BX.message("no_message"):0!==this.params.messageMax&&r>this.params.messageMax&&(s+=BX.message("max_len").replace(/\#MAX_LENGTH\#/gi,this.params.messageMax).replace(/\#LENGTH\#/gi,r)),""!==s)return alert(s),!1;var o=BX.findChild(i,{attribute:{name:"send_button"}},!0);o&&(o.disabled=!0);var a=BX.findChild(i,{attribute:{name:"view_button"}},!0);return a&&(a.disabled=!0),"Y"!=t||(BX.onCustomEvent(e,"onBeforeForumCommentAJAXPost",[i]),BX.onCustomEvent(this.form,"onRequest",[this,t]),setTimeout(BX.delegate(function(){BX.ajax.submit(i,BX.delegate(this.get,this))},this),50),!1)},get:function(){this.form.BXFormSubmit_save=null;var t=e.forumAjaxPostTmp;if(e.curpage=e.curpage||top.window.location.href,BX.onCustomEvent(e,"onForumCommentAJAXPost",[t,this.form]),void 0===t||t.reload)BX.reload(e.curpage);else{if(t.status){if(t.allMessages||void 0!==t.message)BX.onCustomEvent(this.form,"onAdd",[t.messageID,t]),this.clear();else if(t.previewMessage){var i=BX.findChild(document,{className:"reviews-preview"},!0),s=BX.findChild(document,{className:/reviews-reply-form|reviews-collapse/},!0).parentNode,r=e.fTextToNode(t.previewMessage);e.fReplaceOrInsertNode(r,i,s,{className:/reviews-reply-form|reviews-collapse/}),e.PostFormAjaxStatus(""),e.fRunScripts(t.previewMessage)}var o=t.messageID?BX("message"+t.messageID):null;o&&BX.scrollToNode(o)}for(var a=this.form.getElementsByTagName("input"),n=0;n<a.length;n++){var d=a[n];"submit"==d.getAttribute("type")&&(d.disabled=!1)}t.statusMessage&&e.PostFormAjaxStatus(t.statusMessage),BX.onCustomEvent(this.form,"onResponse",[t,this.form]),BX.onCustomEvent(e,"onAfterForumCommentAJAXPost",[t,this.form])}},clear:function(){if(this.editor.ReInit(""),this.editor.fAutosave&&BX.bind(this.editor.pEditorDocument,"keydown",BX.proxy(this.editor.fAutosave.Init,this.editor.fAutosave)),BX.type.isDomNode(this.form)){var e=BX.findChild(document,{className:"reviews-preview"},!0);e&&BX.remove(e);for(var t,i,s,r=0;(t=BX("upload_files_"+r+++"_"+this.form.index.value))&&t;)(i=BX.findChild(t,{tag:"input"}))&&s&&((s=BX.clone(i)).value="",i.parentNode.insertBefore(s,i),i.parentNode.removeChild(i)),BX.hide(t);var o=BX.findChild(this.form,{className:"forum-upload-file-attach"},!0);o&&BX.show(o);var a=BX.findChild(this.form,{className:"reviews-upload-info"},!0);a&&BX.hide(a);var n=null,d=BX.findChild(this.form,{attr:{name:"captcha_code"}},!0),l=BX.findChild(this.form,{attr:{name:"captcha_word"}},!0),h=BX.findChild(this.form,{className:"reviews-reply-field-captcha-image"},!0);h&&(n=BX.findChild(h,{tag:"img"})),d&&l&&n&&(l.value="",BX.ajax.getCaptcha(function(e){d.value=e.captcha_sid,n.src="/bitrix/tools/captcha.php?captcha_code="+e.captcha_sid}))}},show:function(){return BX.onCustomEvent(this.form,"onBeforeShow",[this]),BX.show(this.form.parentNode),BX.scrollToNode(BX.findChild(this.form,{attribute:{name:"send_button"}},!0)),setTimeout(BX.delegate(function(){this.editor.SetFocus(),BX.defer(this.editor.SetFocus,this.editor)()},this),100),BX.onCustomEvent(this.form,"onAfterShow",[this]),!1},hide:function(){return BX.onCustomEvent(this.form,"onBeforeHide",[this]),BX.hide(this.form.parentNode),BX.onCustomEvent(this.form,"onAfterHide",[this]),!1},transverse:function(){return"none"==this.form.parentNode.style.display?this.show():this.hide(),!1},paste:function(e,t){BX.onCustomEvent(this.form,"onPaste",[e,t,this]);var i=e.author?e.author:"",s=e.text?e.text:"",r=e.id?e.id:"";i?"code"==this.editor.sEditorMode&&this.editor.bBBCode?i=i.id>0?"[USER="+i.id+"]"+i.name+"[/USER]":i.name:"html"==this.editor.sEditorMode&&(i.name=i.name.replace(/</gi,"&lt;").replace(/>/gi,"&gt;"),i=i.id>0?'<span id="'+this.editor.SetBxTag(!1,{tag:"postuser",params:{value:i.id}})+'" style="color: #2067B0; border-bottom: 1px dashed #2067B0;">'+i.name+"</span>":"<span>"+i.name+"</span>"):i="","QUOTE"==t?"code"==this.editor.sEditorMode&&this.editor.bBBCode?this.editor.WrapWith("[QUOTE"+(r>0?" ID="+r:"")+"]","[/QUOTE]",(""!==i?i+BX.message("f_author")+"\n":"")+s):"html"==this.editor.sEditorMode&&this.editor.InsertHTML('<blockquote class="bx-quote" id="mess'+r+'">'+(""!==i?i+BX.message("f_author")+"<br/>":"")+this.editor.ParseContent(s,!0)+"</blockquote><br/>"):(s=(i?i+", ":"")+this.editor.ParseContent(s,!0),"code"==this.editor.sEditorMode&&this.editor.bBBCode?this.editor.WrapWith("","",s):"html"==this.editor.sEditorMode&&this.editor.InsertHTML(s)),this.editor.SetFocus(),BX.defer(this.editor.SetFocus,this.editor)()}},BX.ready(function(){if(BX.browser.IsIE()){var e,t,i,s=BX.findChildren(document,{className:"reviews-post-table"},!0);if(!s)return;for(e=0;e<s.length;e++)for(i=(t=s[e].getElementsByTagName("*")).length;i--;)t[i].scrollWidth>t[i].offsetWidth&&(t[i].style.paddingBottom="20px",t[i].style.overflowY="hidden")}}),e.fTextToNode=function(e){var t=BX.create("div");return t.innerHTML=e,t.childNodes.length>0?t:null},e.PostFormAjaxStatus=function(t){var i,s=BX.findChild(document,{className:"reviews-note-box"},!0,!0);if(s)for(i=0;i<=s.length;i++)BX.remove(s[i]);var r=BX.findChild(document,{className:"reviews-block-container"},!0);if(r&&!(t.length<1)){var o=e.fTextToNode(t);if(o){for(var a=["reviews-reply-form","reviews-collapse"],n=r;(n=n.nextSibling)&&n;)if(1==n.nodeType){var d=!1;for(i=0;i<a.length;i++)if(BX.hasClass(n,a[i])){d=!0;break}if(d){n.parentNode.insertBefore(o,n);break}}if($(".reviews-note-error").length){var l=$(".reviews-note-error").offset().top;$("html, body").animate({scrollTop:l},200)}}}},e.SetReviewsAjaxPostTmp=function(t){e.forumAjaxPostTmp=t},e.fReplaceOrInsertNode=function(t,i,s,r){var o=null;return!!BX.type.isDomNode(s)&&(!(!BX.type.isDomNode(t)&&!BX.type.isArray(t)&&t.length>0&&!(t=e.fTextToNode(t)))&&(BX.type.isDomNode(i)&&(s=i.parentNode,o=i.nextSibling,s.removeChild(i)),o||(o=BX.findChild(s,r,!0)),o?o.parentNode.insertBefore(t,o):s.appendChild(t),!0))},e.fRunScripts=function(e){var t=BX.processHTML(e,!0);BX.ajax.processScripts(t.SCRIPT,!0)},e.ShowLastEditReason=function(e,t){t&&(t.style.display=e?"block":"none")},e.AttachFile=function(e,t,i,s){var r=null,o=!1;e=parseInt(e),t=parseInt(t),document.getElementById("upload_files_info_"+i).style.display="block";for(var a=e;a<e+t&&((r=document.getElementById("upload_files_"+a+"_"+i))&&null!==typeof r);a++)if("none"==r.style.display){o=!0,r.style.display="block";break}!0===(!o||a>=e+t-1)&&(s.style.display="none")},e.GetSelection=function(){var t="";return e.getSelection?t=e.getSelection().toString():document.selection&&(t=document.selection.createRange().text),t}}(window);
/* End */
;; /* /bitrix/templates/aspro_mshop/components/bitrix/forum.topic.reviews/main/script.min.js?151740334115849*/
